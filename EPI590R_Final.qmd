---
title: "EPI590R_Final"
author: "Monica Rivera"
format: html
editor: visual
echo: true
eval: true
---

## Newborn Screening Disorders data set

The [**Screening Disorders by California Region**](https://catalog.data.gov/dataset/newborn-screening-disorders-426e4/resource/54bb2656-0073-4380-bbc7-7ac7919aee38 "Screening Disorders by California Region") data set is a table from an aggregated (2009-2019) public data on newborn screening disorders. The table used in this analysis contains counts of disorders that have been diagnosed by the California Newborn Screening Program.

```{r}
# Load packages #
library(tidyverse)
library(gtsummary)

# Load data #
nsdca <- read_csv(here::here("data", "raw", "nsdca.csv"))
                  
# Clean column names #
nsdca <- nsdca %>%
  rename(
    region = `California Region`,
    disease_type = `Disease Type`,
    cases = `Case\nCount`,
    screened = `Number\nScreened`,
    percent_region = `Percent\nof All\nDisorders\nin Region`
  ) %>%

# Convert percent column to numeric & create factor for categorical variable: region #
  mutate(
    percent_region = as.numeric(percent_region),
    region = factor(region, labels = c("Central Coast", "Los Angeles", "Northern Central Valley", "Northern, Mountain, and Desert Areas", "San Francisco Bay Area", "South Coast", "Southern Inland Empire")
))

# Remove rows with missing values #
nsdca_cleaned <- nsdca %>%
  filter(!is.na(percent_region))

# Display the structure of the cleaned data frame #
str(nsdca_cleaned)

# Save the cleaned data to a new CSV file #
write_csv(nsdca_cleaned, "cleaned_nsdca.csv")

# Create data/clean folder #
if (!dir.exists(here::here("data", "clean"))) {
  dir.create(here::here("data", "clean"))
}

# Save the complete-case data #
write_rds(nsdca_cleaned, here::here("data", "clean", "nsdca_cleaned_complete.rds"))
```

1.  Create a `{gtsummary}` table of descriptive statistics about your data (1 pt)

```{r}
# Cross-reference #
#| label: tbl-one
#| tbl-cap: "Descriptive Statistics for 'Case Count, Number Screened, and Percent of All Disorders in Region"
#| message: false
#| echo: true

# The table will show descriptive statistics for 'Case Count', 'Number Screened', and 'Percent of All Disorders in Region' including an overall column. #
tbl_summary(
  nsdca_cleaned,
  by = region,
  include = c(region, cases, screened, percent_region),
  label = list(
    cases ~ "Case Count",
    screened ~ "Number Screened",
    percent_region ~ "Percent of All Disorders in Region"
  )
) %>%
  add_overall() %>% 
modify_table_styling(
  columns = label,
  rows = label == "Percent of All Disorders in Region",
  footnote = "see https://catalog.data.gov/dataset/newborn-screening-disorders-426e4"
)

# Cross-reference #
#| label: tbl-descr
#| tbl-cap: "Descriptive Statistics"
#| output-location: slide

# Inline statistics #
table1 <- tbl_summary(
  nsdca_cleaned,
  by = region,
   include = c(region, cases, screened, percent_region)) |> 
  add_overall(last = TRUE)
inline_text(table1, variable = "percent_region", column = "stat_1")

# Cross-reference #
total_sample <- nrow(nsdca_cleaned)
```

Descriptive statistics for the `Case Count`, `Number Screened`, and `California Region` variables are presented in @tbl-one.

There were `r total_sample` California regions.

2.  Fit a regression and present well-formatted results from the regression (1 pt)

    ```{r}
    # Cross-reference #
    #| label: tbl-two
    #| tbl-cap: "Linear Regression results"

    # Fit a linear regression model predicting 'Case Count' from 'Number Screened' #
    linear_model <- lm(cases ~ screened, data = nsdca_cleaned)

    # Present the regression results using {gtsummary} #
    tbl_regression(linear_model, 
                   intercept = TRUE, 
                   label = list(screened ~ "Number Screened"))

    ```

    The results, shown in @tbl-two indicate that the number of screened newborns is a statistically significant predictor of the number of cases.

3.  Create a figure (1 pt)

    ```{r}
    # Cross-reference #
    #| label: fig-hist
    #| fig-cap: "Case Count Distribution"

    # A histogram of the 'Case Count' #
    histogram_figure <- ggplot(nsdca_cleaned, aes(x = cases)) +
      geom_histogram(binwidth = 25, fill = "lightblue", color = "black") +
      labs(
        title = "Histogram of Case Counts",
        x = "Case Count",
        y = "Frequency"
      )
    print(histogram_figure)

    # Cross-reference #
    #| label: fig-three
    #| fig-cap: "Percent of All Disorders in Region and Case Count Distribution"

    # A scatter plot of 'Percent of All Disorders in Region' and 'Case Count' #
    ggplot(data = nsdca_cleaned,
    mapping = aes(
    x = percent_region,
    y = cases,
    color = region
    )
    ) +
    	geom_point() +
    	labs(title = "Percent of All Disorders in Region and Case Count",
    subtitle = "Dimensions for Central Coast, Los Angeles, Northern Central Valley, Northern, Mountain, and Desert Areas, San Francisco Bay Area, South Coast, Southern Inland Empire" ,
    x = "% of All Disorders in Region", y = "Case Count",
    color = "Region")
    ```

    The distribution of `Case Count` is right-skewed, with most regions having a relatively low number of cases and a few having a high number of cases, as shown in \@fig-hist. \@fig-three contains a scatter plot across `total_sample` regions.

4.  Write *and* use a function that does something with the data (1 pt)

    ```{r}
    # A function that calculates the mean and standard deviation for a given numeric variable #
    calculate_stats <- function(data, variable) {
    	data %>%
    		summarise(
    			mean = mean({{ variable }}, na.rm = TRUE),
    			sd = sd({{ variable }}, na.rm = TRUE)
    		)
    }

    # Functions to calculate stats for 'Case Count' and 'Number Screened' and store the results in a list #
    case_count_stats <- calculate_stats(nsdca_cleaned, cases)

    case_count_stats

    screened_stats <- calculate_stats(nsdca_cleaned, screened)

    screened_stats
    ```

    The mean for cases is `calculate_stats$mean` while the standard deviation is `calculate_stats$sd`.

5.  The table, regression results, and figure, with appropriate captions (1 pt)

    ```{r}
    # Inline stastistics for univariate regression #
    screened_table <- tbl_uvregression(
      nsdca_cleaned,
      y = screened,
      include = c(
        region, screened, cases, percent_region
      ),
      method = lm
    )
    inline_text(screened_table, variable = "cases")
    inline_text(screened_table, variable = "cases", pattern = "{p.value}")
    ```

    The p-value for the univariate regression for `screened` is `r p.value`.

6.  Read in a dataset and save a file (can be data, table, figure, etc.) Use the `{here}` package every time you refer to file paths (at least twice) (1 pt)

7.  Commit and push your work to GitHub as you go (1 pt)

8.  In a README file, include any notes necessary for us to easily reproduce your analysis (e.g., “Run `script.R` and then render `document.qmd`”) as well as some information about your data (1 pt)
